# Handy commands:
# docker system prune -a    # remove all images and containers

version: '3'
services:
  api:
    image: wilfongjt/aad-hapi

    build:
      context: ./aad-hapi

    command: >
      bash -c "npm install && npm install nodemon && npm run dev"

    volumes:
      - ./aad-hapi:/usr/src/app

    ports:
      - "3001:3001"

    #  dockerfile          | 3000       | 3000       | 3000      | 3001
    #  docke-comp          | 3000:3000  | 3000:3001  | 3001:3000 | 3001:3001
    #  api                 | 3000       | 3001       | 3001      | 3001
    #  http://0.0.0.0:3000 |  ok        | ok         | no        |
    #  http://0.0.0.0:3001 |  no        | no         | no        |
    environment:
      - NODE_ENV=${NODE_ENV}
      - LB_API_PORT=${LB_API_PORT}
      - LB_API_HOST=${LB_API_HOST}
      - LB_SECRET=${LB_SECRET}
      - LB_API_TOKEN=${LB_API_TOKEN}
      - LB_JWT_CLAIMS=${LB_JWT_CLAIMS}

    networks:
      - backend

    restart: always

networks:
  backend:
    driver: bridge
